import{L as ie,T as Ge,R as Ue,U as $e,a as We,O as Ve,P as Xe,S as _e,b as ae,N as Ye,A as Ke,B as Je,M as Qe,C as Ze,W as et,c as tt,d as nt,e as rt,V as ot,f as Z,g as it,h as at,i as st}from"./three-ecc16f68.js";import{r as R}from"./react-4c174557.js";import{R as lt,c as X}from"./react-reconciler-598e02de.js";import{c as ct}from"./zustand-d041018f.js";import{s as ut,p as ft,c as dt}from"./suspend-react-4f9dedb1.js";import{_ as ke}from"./@babel-98964cd2.js";import{u as pt}from"./react-use-measure-1feb8bff.js";import{F as vt,u as mt}from"./its-fine-8a4e2c73.js";function Vt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Oe={exports:{}},Re={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(g,P){var b=g.length;g.push(P);e:for(;0<b;){var k=b-1>>>1,O=g[k];if(0<d(O,P))g[k]=P,g[b]=O,b=k;else break e}}function o(g){return g.length===0?null:g[0]}function s(g){if(g.length===0)return null;var P=g[0],b=g.pop();if(b!==P){g[0]=b;e:for(var k=0,O=g.length,B=O>>>1;k<B;){var L=2*(k+1)-1,K=g[L],H=L+1,te=g[H];if(0>d(K,b))H<O&&0>d(te,K)?(g[k]=te,g[H]=b,k=H):(g[k]=K,g[L]=b,k=L);else if(H<O&&0>d(te,b))g[k]=te,g[H]=b,k=H;else break e}}return P}function d(g,P){var b=g.sortIndex-P.sortIndex;return b!==0?b:g.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;e.unstable_now=function(){return v.now()}}else{var C=Date,_=C.now();e.unstable_now=function(){return C.now()-_}}var i=[],m=[],n=1,r=null,c=3,u=!1,f=!1,w=!1,h=typeof setTimeout=="function"?setTimeout:null,a=typeof clearTimeout=="function"?clearTimeout:null,l=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function p(g){for(var P=o(m);P!==null;){if(P.callback===null)s(m);else if(P.startTime<=g)s(m),P.sortIndex=P.expirationTime,t(i,P);else break;P=o(m)}}function E(g){if(w=!1,p(g),!f)if(o(i)!==null)f=!0,N(S);else{var P=o(m);P!==null&&z(E,P.startTime-g)}}function S(g,P){f=!1,w&&(w=!1,a(D),D=-1),u=!0;var b=c;try{for(p(P),r=o(i);r!==null&&(!(r.expirationTime>P)||g&&!y());){var k=r.callback;if(typeof k=="function"){r.callback=null,c=r.priorityLevel;var O=k(r.expirationTime<=P);P=e.unstable_now(),typeof O=="function"?r.callback=O:r===o(i)&&s(i),p(P)}else s(i);r=o(i)}if(r!==null)var B=!0;else{var L=o(m);L!==null&&z(E,L.startTime-P),B=!1}return B}finally{r=null,c=b,u=!1}}var M=!1,x=null,D=-1,I=5,j=-1;function y(){return!(e.unstable_now()-j<I)}function T(){if(x!==null){var g=e.unstable_now();j=g;var P=!0;try{P=x(!0,g)}finally{P?F():(M=!1,x=null)}}else M=!1}var F;if(typeof l=="function")F=function(){l(T)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,G=q.port2;q.port1.onmessage=T,F=function(){G.postMessage(null)}}else F=function(){h(T,0)};function N(g){x=g,M||(M=!0,F())}function z(g,P){D=h(function(){g(e.unstable_now())},P)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(g){g.callback=null},e.unstable_continueExecution=function(){f||u||(f=!0,N(S))},e.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<g?Math.floor(1e3/g):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return o(i)},e.unstable_next=function(g){switch(c){case 1:case 2:case 3:var P=3;break;default:P=c}var b=c;c=P;try{return g()}finally{c=b}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(g,P){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var b=c;c=g;try{return P()}finally{c=b}},e.unstable_scheduleCallback=function(g,P,b){var k=e.unstable_now();switch(typeof b=="object"&&b!==null?(b=b.delay,b=typeof b=="number"&&0<b?k+b:k):b=k,g){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=b+O,g={id:n++,callback:P,priorityLevel:g,startTime:b,expirationTime:O,sortIndex:-1},b>k?(g.sortIndex=b,t(m,g),o(i)===null&&g===o(m)&&(w?(a(D),D=-1):w=!0,z(E,b-k))):(g.sortIndex=O,t(i,g),f||u||(f=!0,N(S))),g},e.unstable_shouldYield=y,e.unstable_wrapCallback=function(g){var P=c;return function(){var b=c;c=P;try{return g.apply(this,arguments)}finally{c=b}}}})(Re);Oe.exports=Re;var ye=Oe.exports;const ge={},ht=e=>void Object.assign(ge,e);function gt(e,t){function o(n,{args:r=[],attach:c,...u},f){let w=`${n[0].toUpperCase()}${n.slice(1)}`,h;if(n==="primitive"){if(u.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const a=u.object;h=W(a,{type:n,root:f,attach:c,primitive:!0})}else{const a=ge[w];if(!a)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");h=W(new a(...r),{type:n,root:f,attach:c,memoizedProps:{args:r}})}return h.__r3f.attach===void 0&&(h instanceof Je?h.__r3f.attach="geometry":h instanceof Qe&&(h.__r3f.attach="material")),w!=="inject"&&ce(h,u),h}function s(n,r){let c=!1;if(r){var u,f;(u=r.__r3f)!=null&&u.attach?le(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),c=!0),c||(f=n.__r3f)==null||f.objects.push(r),r.__r3f||W(r,{}),r.__r3f.parent=n,he(r),V(r)}}function d(n,r,c){let u=!1;if(r){var f,w;if((f=r.__r3f)!=null&&f.attach)le(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"});const h=n.children.filter(l=>l!==r),a=h.indexOf(c);n.children=[...h.slice(0,a),r,...h.slice(a)],u=!0}u||(w=n.__r3f)==null||w.objects.push(r),r.__r3f||W(r,{}),r.__r3f.parent=n,he(r),V(r)}}function v(n,r,c=!1){n&&[...n].forEach(u=>C(r,u,c))}function C(n,r,c){if(r){var u,f,w;if(r.__r3f&&(r.__r3f.parent=null),(u=n.__r3f)!=null&&u.objects&&(n.__r3f.objects=n.__r3f.objects.filter(E=>E!==r)),(f=r.__r3f)!=null&&f.attach)Ee(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var h;n.remove(r),(h=r.__r3f)!=null&&h.root&&St(r.__r3f.root,r)}const l=(w=r.__r3f)==null?void 0:w.primitive,p=c===void 0?r.dispose!==null&&!l:c;if(!l){var a;v((a=r.__r3f)==null?void 0:a.objects,r,p),v(r.children,r,p)}delete r.__r3f,p&&r.dispose&&r.type!=="Scene"&&ye.unstable_scheduleCallback(ye.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),V(n)}}function _(n,r,c,u){var f;const w=(f=n.__r3f)==null?void 0:f.parent;if(!w)return;const h=o(r,c,n.__r3f.root);if(n.children){for(const a of n.children)a.__r3f&&s(h,a);n.children=n.children.filter(a=>!a.__r3f)}n.__r3f.objects.forEach(a=>s(h,a)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||C(w,n),h.parent&&(h.__r3f.autoRemovedBeforeAppend=!0),s(w,h),h.raycast&&h.__r3f.eventCount&&h.__r3f.root.getState().internal.interaction.push(h),[u,u.alternate].forEach(a=>{a!==null&&(a.stateNode=h,a.ref&&(typeof a.ref=="function"?a.ref(h):a.ref.current=h))})}const i=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:lt({createInstance:o,removeChild:C,appendChild:s,appendInitialChild:s,insertBefore:d,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const c=n.getState().scene;c.__r3f&&(c.__r3f.root=n,s(c,r))},removeChildFromContainer:(n,r)=>{r&&C(n.getState().scene,r)},insertInContainerBefore:(n,r,c)=>{if(!r||!c)return;const u=n.getState().scene;u.__r3f&&d(u,r,c)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,c,u){if(n.__r3f.primitive&&u.object&&u.object!==n)return[!0];{const{args:f=[],children:w,...h}=u,{args:a=[],children:l,...p}=c;if(!Array.isArray(f))throw new Error("R3F: the args prop must be an array!");if(f.some((S,M)=>S!==a[M]))return[!0];const E=Ie(n,h,p,!0);return E.changes.length?[!1,E]:null}},commitUpdate(n,[r,c],u,f,w,h){r?_(n,u,w,h):ce(n,c)},commitMount(n,r,c,u){var f;const w=(f=n.__r3f)!=null?f:{};n.raycast&&w.handlers&&w.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>W(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:c,parent:u}=(r=n.__r3f)!=null?r:{};c&&u&&Ee(u,n,c),n.isObject3D&&(n.visible=!1),V(n)},unhideInstance(n,r){var c;const{attach:u,parent:f}=(c=n.__r3f)!=null?c:{};u&&f&&le(f,n,u),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),V(n)},createTextInstance:i,hideTextInstance:i,unhideTextInstance:i,getCurrentEventPriority:()=>t?t():X.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&A.fun(performance.now)?performance.now:A.fun(Date.now)?Date.now:()=>0,scheduleTimeout:A.fun(setTimeout)?setTimeout:void 0,cancelTimeout:A.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ce}}var we,be;const se=e=>"colorSpace"in e||"outputColorSpace"in e,Te=()=>{var e;return(e=ge.ColorManagement)!=null?e:null},je=e=>e&&e.isOrthographicCamera,_t=e=>e&&e.hasOwnProperty("current"),ee=typeof window<"u"&&((we=window.document)!=null&&we.createElement||((be=window.navigator)==null?void 0:be.product)==="ReactNative")?R.useLayoutEffect:R.useEffect;function xe(e){const t=R.useRef(e);return ee(()=>void(t.current=e),[e]),t}function yt({set:e}){return ee(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Ae extends R.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Ae.getDerivedStateFromError=()=>({error:!0});const De="__default",Ce=new Map,wt=e=>e&&!!e.memoized&&!!e.changes;function Le(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const J=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},A={obj:e=>e===Object(e)&&!A.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:s="reference",strict:d=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(A.str(e)||A.num(e))return e===t;const v=A.obj(e);if(v&&s==="reference")return e===t;const C=A.arr(e);if(C&&o==="reference")return e===t;if((C||v)&&e===t)return!0;let _;for(_ in e)if(!(_ in t))return!1;if(v&&o==="shallow"&&s==="shallow"){for(_ in d?t:e)if(!A.equ(e[_],t[_],{strict:d,objects:"reference"}))return!1}else for(_ in d?t:e)if(e[_]!==t[_])return!1;if(A.und(_)){if(C&&e.length===0&&t.length===0||v&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function bt(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function Ct(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function W(e,t){const o=e;return(t!=null&&t.primitive||!o.__r3f)&&(o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function me(e,t){let o=e;if(t.includes("-")){const s=t.split("-"),d=s.pop();return o=s.reduce((v,C)=>v[C],e),{target:o,key:d}}else return{target:o,key:t}}const Pe=/-\d+$/;function le(e,t,o){if(A.str(o)){if(Pe.test(o)){const v=o.replace(Pe,""),{target:C,key:_}=me(e,v);Array.isArray(C[_])||(C[_]=[])}const{target:s,key:d}=me(e,o);t.__r3f.previousAttach=s[d],s[d]=t}else t.__r3f.previousAttach=o(e,t)}function Ee(e,t,o){var s,d;if(A.str(o)){const{target:v,key:C}=me(e,o),_=t.__r3f.previousAttach;_===void 0?delete v[C]:v[C]=_}else(s=t.__r3f)==null||s.previousAttach==null||s.previousAttach(e,t);(d=t.__r3f)==null||delete d.previousAttach}function Ie(e,{children:t,key:o,ref:s,...d},{children:v,key:C,ref:_,...i}={},m=!1){var n;const r=(n=e==null?void 0:e.__r3f)!=null?n:{},c=Object.entries(d),u=[];if(m){const w=Object.keys(i);for(let h=0;h<w.length;h++)d.hasOwnProperty(w[h])||c.unshift([w[h],De+"remove"])}c.forEach(([w,h])=>{var a;if((a=e.__r3f)!=null&&a.primitive&&w==="object"||A.equ(h,i[w]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(w))return u.push([w,h,!0,[]]);let l=[];w.includes("-")&&(l=w.split("-")),u.push([w,h,!1,l]);for(const p in d){const E=d[p];p.startsWith(`${w}-`)&&u.push([p,E,!1,p.split("-")])}});const f={...d};return r.memoizedProps&&r.memoizedProps.args&&(f.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(f.attach=r.memoizedProps.attach),{memoized:f,changes:u}}function ce(e,t){var o,s,d;const v=(o=e.__r3f)!=null?o:{},C=v.root,_=(s=C==null||C.getState==null?void 0:C.getState())!=null?s:{},{memoized:i,changes:m}=wt(t)?t:Ie(e,t),n=v.eventCount;e.__r3f&&(e.__r3f.memoizedProps=i);for(let c=0;c<m.length;c++){let[u,f,w,h]=m[c];if(se(e)){const E="srgb",S="srgb-linear";u==="encoding"?(u="colorSpace",f=f===3001?E:S):u==="outputEncoding"&&(u="outputColorSpace",f=f===3001?E:S)}let a=e,l=a[u];if(h.length&&(l=h.reduce((p,E)=>p[E],e),!(l&&l.set))){const[p,...E]=h.reverse();a=E.reverse().reduce((S,M)=>S[M],e),u=p}if(f===De+"remove")if(a.constructor){let p=Ce.get(a.constructor);p||(p=new a.constructor,Ce.set(a.constructor,p)),f=p[u]}else f=0;if(w)f?v.handlers[u]=f:delete v.handlers[u],v.eventCount=Object.keys(v.handlers).length;else if(l&&l.set&&(l.copy||l instanceof ie)){if(Array.isArray(f))l.fromArray?l.fromArray(f):l.set(...f);else if(l.copy&&f&&f.constructor&&l.constructor===f.constructor)l.copy(f);else if(f!==void 0){const p=l instanceof Ze;!p&&l.setScalar?l.setScalar(f):l instanceof ie&&f instanceof ie?l.mask=f.mask:l.set(f),!Te()&&!_.linear&&p&&l.convertSRGBToLinear()}}else if(a[u]=f,a[u]instanceof Ge&&a[u].format===Ue&&a[u].type===$e){const p=a[u];se(p)&&se(_.gl)?p.colorSpace=_.gl.outputColorSpace:p.encoding=_.gl.outputEncoding}V(e)}if(v.parent&&_.internal&&e.raycast&&n!==v.eventCount){const c=_.internal.interaction.indexOf(e);c>-1&&_.internal.interaction.splice(c,1),v.eventCount&&_.internal.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(d=e.__r3f)!=null&&d.parent&&he(e),e}function V(e){var t,o;const s=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();s&&s.internal.frames===0&&s.invalidate()}function he(e){e.onUpdate==null||e.onUpdate(e)}function Pt(e,t){e.manual||(je(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ne(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Et(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return X.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return X.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return X.ContinuousEventPriority;default:return X.DefaultEventPriority}}function Fe(e,t,o,s){const d=o.get(t);d&&(o.delete(t),o.size===0&&(e.delete(s),d.target.releasePointerCapture(s)))}function St(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(s=>s!==t),o.initialHits=o.initialHits.filter(s=>s!==t),o.hovered.forEach((s,d)=>{(s.eventObject===t||s.object===t)&&o.hovered.delete(d)}),o.capturedMap.forEach((s,d)=>{Fe(o.capturedMap,t,s,d)})}function Mt(e){function t(i){const{internal:m}=e.getState(),n=i.offsetX-m.initialClick[0],r=i.offsetY-m.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(i){return i.filter(m=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=m.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function s(i,m){const n=e.getState(),r=new Set,c=[],u=m?m(n.internal.interaction):n.internal.interaction;for(let a=0;a<u.length;a++){const l=J(u[a]);l&&(l.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(i,n);function f(a){const l=J(a);if(!l||!l.events.enabled||l.raycaster.camera===null)return[];if(l.raycaster.camera===void 0){var p;l.events.compute==null||l.events.compute(i,l,(p=l.previousRoot)==null?void 0:p.getState()),l.raycaster.camera===void 0&&(l.raycaster.camera=null)}return l.raycaster.camera?l.raycaster.intersectObject(a,!0):[]}let w=u.flatMap(f).sort((a,l)=>{const p=J(a.object),E=J(l.object);return!p||!E?a.distance-l.distance:E.events.priority-p.events.priority||a.distance-l.distance}).filter(a=>{const l=ne(a);return r.has(l)?!1:(r.add(l),!0)});n.events.filter&&(w=n.events.filter(w,n));for(const a of w){let l=a.object;for(;l;){var h;(h=l.__r3f)!=null&&h.eventCount&&c.push({...a,eventObject:l}),l=l.parent}}if("pointerId"in i&&n.internal.capturedMap.has(i.pointerId))for(let a of n.internal.capturedMap.get(i.pointerId).values())r.has(ne(a.intersection))||c.push(a.intersection);return c}function d(i,m,n,r){const c=e.getState();if(i.length){const u={stopped:!1};for(const f of i){const w=J(f.object)||c,{raycaster:h,pointer:a,camera:l,internal:p}=w,E=new Z(a.x,a.y,0).unproject(l),S=j=>{var y,T;return(y=(T=p.capturedMap.get(j))==null?void 0:T.has(f.eventObject))!=null?y:!1},M=j=>{const y={intersection:f,target:m.target};p.capturedMap.has(j)?p.capturedMap.get(j).set(f.eventObject,y):p.capturedMap.set(j,new Map([[f.eventObject,y]])),m.target.setPointerCapture(j)},x=j=>{const y=p.capturedMap.get(j);y&&Fe(p.capturedMap,f.eventObject,y,j)};let D={};for(let j in m){let y=m[j];typeof y!="function"&&(D[j]=y)}let I={...f,...D,pointer:a,intersections:i,stopped:u.stopped,delta:n,unprojectedPoint:E,ray:h.ray,camera:l,stopPropagation(){const j="pointerId"in m&&p.capturedMap.get(m.pointerId);if((!j||j.has(f.eventObject))&&(I.stopped=u.stopped=!0,p.hovered.size&&Array.from(p.hovered.values()).find(y=>y.eventObject===f.eventObject))){const y=i.slice(0,i.indexOf(f));v([...y,f])}},target:{hasPointerCapture:S,setPointerCapture:M,releasePointerCapture:x},currentTarget:{hasPointerCapture:S,setPointerCapture:M,releasePointerCapture:x},nativeEvent:m};if(r(I),u.stopped===!0)break}}return i}function v(i){const{internal:m}=e.getState();for(const n of m.hovered.values())if(!i.length||!i.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const c=n.eventObject.__r3f,u=c==null?void 0:c.handlers;if(m.hovered.delete(ne(n)),c!=null&&c.eventCount){const f={...n,intersections:i};u.onPointerOut==null||u.onPointerOut(f),u.onPointerLeave==null||u.onPointerLeave(f)}}}function C(i,m){for(let n=0;n<m.length;n++){const r=m[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(i)}}function _(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>v([]);case"onLostPointerCapture":return m=>{const{internal:n}=e.getState();"pointerId"in m&&n.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(m.pointerId)&&(n.capturedMap.delete(m.pointerId),v([]))})}}return function(n){const{onPointerMissed:r,internal:c}=e.getState();c.lastEvent.current=n;const u=i==="onPointerMove",f=i==="onClick"||i==="onContextMenu"||i==="onDoubleClick",h=s(n,u?o:void 0),a=f?t(n):0;i==="onPointerDown"&&(c.initialClick=[n.offsetX,n.offsetY],c.initialHits=h.map(p=>p.eventObject)),f&&!h.length&&a<=2&&(C(n,c.interaction),r&&r(n)),u&&v(h);function l(p){const E=p.eventObject,S=E.__r3f,M=S==null?void 0:S.handlers;if(S!=null&&S.eventCount)if(u){if(M.onPointerOver||M.onPointerEnter||M.onPointerOut||M.onPointerLeave){const x=ne(p),D=c.hovered.get(x);D?D.stopped&&p.stopPropagation():(c.hovered.set(x,p),M.onPointerOver==null||M.onPointerOver(p),M.onPointerEnter==null||M.onPointerEnter(p))}M.onPointerMove==null||M.onPointerMove(p)}else{const x=M[i];x?(!f||c.initialHits.includes(E))&&(C(n,c.interaction.filter(D=>!c.initialHits.includes(D))),x(p)):f&&c.initialHits.includes(E)&&C(n,c.interaction.filter(D=>!c.initialHits.includes(D)))}}d(h,n,a,l)}}return{handlePointer:_}}const ze=e=>!!(e!=null&&e.render),Be=R.createContext(null),kt=(e,t)=>{const o=ct((_,i)=>{const m=new Z,n=new Z,r=new Z;function c(a=i().camera,l=n,p=i().size){const{width:E,height:S,top:M,left:x}=p,D=E/S;l instanceof Z?r.copy(l):r.set(...l);const I=a.getWorldPosition(m).distanceTo(r);if(je(a))return{width:E/a.zoom,height:S/a.zoom,top:M,left:x,factor:1,distance:I,aspect:D};{const j=a.fov*Math.PI/180,y=2*Math.tan(j/2)*I,T=y*(E/S);return{width:T,height:y,top:M,left:x,factor:E/T,distance:I,aspect:D}}}let u;const f=a=>_(l=>({performance:{...l.performance,current:a}})),w=new it;return{set:_,get:i,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(a=1)=>e(i(),a),advance:(a,l)=>t(a,l,i()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new at,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const a=i();u&&clearTimeout(u),a.performance.current!==a.performance.min&&f(a.performance.min),u=setTimeout(()=>f(i().performance.max),a.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:a=>_(l=>({...l,events:{...l.events,...a}})),setSize:(a,l,p,E,S)=>{const M=i().camera,x={width:a,height:l,top:E||0,left:S||0,updateStyle:p};_(D=>({size:x,viewport:{...D.viewport,...c(M,n,x)}}))},setDpr:a=>_(l=>{const p=Le(a);return{viewport:{...l.viewport,dpr:p,initialDpr:l.viewport.initialDpr||p}}}),setFrameloop:(a="always")=>{const l=i().clock;l.stop(),l.elapsedTime=0,a!=="never"&&(l.start(),l.elapsedTime=0),_(()=>({frameloop:a}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:R.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(a,l,p)=>{const E=i().internal;return E.priority=E.priority+(l>0?1:0),E.subscribers.push({ref:a,priority:l,store:p}),E.subscribers=E.subscribers.sort((S,M)=>S.priority-M.priority),()=>{const S=i().internal;S!=null&&S.subscribers&&(S.priority=S.priority-(l>0?1:0),S.subscribers=S.subscribers.filter(M=>M.ref!==a))}}}}}),s=o.getState();let d=s.size,v=s.viewport.dpr,C=s.camera;return o.subscribe(()=>{const{camera:_,size:i,viewport:m,gl:n,set:r}=o.getState();if(i!==d||m.dpr!==v){var c;d=i,v=m.dpr,Pt(_,i),n.setPixelRatio(m.dpr);const u=(c=i.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(i.width,i.height,u)}_!==C&&(C=_,r(u=>({viewport:{...u.viewport,...u.viewport.getCurrentViewport(_)}})))}),o.subscribe(_=>e(_)),o};let re,Ot=new Set,Rt=new Set,Tt=new Set;function ue(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function Q(e,t){switch(e){case"before":return ue(Ot,t);case"after":return ue(Rt,t);case"tail":return ue(Tt,t)}}let fe,de;function pe(e,t,o){let s=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(s=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),fe=t.internal.subscribers,re=0;re<fe.length;re++)de=fe[re],de.ref.current(de.store.getState(),s,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function jt(e){let t=!1,o,s,d;function v(i){s=requestAnimationFrame(v),t=!0,o=0,Q("before",i);for(const n of e.values()){var m;d=n.store.getState(),d.internal.active&&(d.frameloop==="always"||d.internal.frames>0)&&!((m=d.gl.xr)!=null&&m.isPresenting)&&(o+=pe(i,d))}if(Q("after",i),o===0)return Q("tail",i),t=!1,cancelAnimationFrame(s)}function C(i,m=1){var n;if(!i)return e.forEach(r=>C(r.store.getState()),m);(n=i.gl.xr)!=null&&n.isPresenting||!i.internal.active||i.frameloop==="never"||(i.internal.frames=Math.min(60,i.internal.frames+m),t||(t=!0,requestAnimationFrame(v)))}function _(i,m=!0,n,r){if(m&&Q("before",i),n)pe(i,n,r);else for(const c of e.values())pe(i,c.store.getState());m&&Q("after",i)}return{loop:v,invalidate:C,advance:_}}function xt(){const e=R.useContext(Be);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Xt(e,t=0){const o=xt(),s=o.getState().internal.subscribe,d=xe(e);return ee(()=>s(d,t,o),[t,s,o]),null}function He(e,t){return function(o,...s){const d=new o;return e&&e(d),Promise.all(s.map(v=>new Promise((C,_)=>d.load(v,i=>{i.scene&&Object.assign(i,bt(i.scene)),C(i)},t,i=>_(new Error(`Could not load ${v}: ${i.message})`))))))}}function Ne(e,t,o,s){const d=Array.isArray(t)?t:[t],v=ut(He(o,s),[e,...d],{equal:A.equ});return Array.isArray(t)?v:v[0]}Ne.preload=function(e,t,o){const s=Array.isArray(t)?t:[t];return ft(He(o),[e,...s])};Ne.clear=function(e,t){const o=Array.isArray(t)?t:[t];return dt([e,...o])};const Y=new Map,{invalidate:Se,advance:Me}=jt(Y),{reconciler:oe,applyProps:U}=gt(Y,Et),$={objects:"shallow",strict:!1},At=(e,t)=>{const o=typeof e=="function"?e(t):e;return ze(o)?o:new et({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Dt(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:s,top:d,left:v}=e.parentElement.getBoundingClientRect();return{width:o,height:s,top:d,left:v}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Lt(e){const t=Y.get(e),o=t==null?void 0:t.fiber,s=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const d=typeof reportError=="function"?reportError:console.error,v=s||kt(Se,Me),C=o||oe.createContainer(v,X.ConcurrentRoot,null,!1,null,"",d,null);t||Y.set(e,{fiber:C,store:v});let _,i=!1,m;return{configure(n={}){let{gl:r,size:c,scene:u,events:f,onCreated:w,shadows:h=!1,linear:a=!1,flat:l=!1,legacy:p=!1,orthographic:E=!1,frameloop:S="always",dpr:M=[1,2],performance:x,raycaster:D,camera:I,onPointerMissed:j}=n,y=v.getState(),T=y.gl;y.gl||y.set({gl:T=At(r,e)});let F=y.raycaster;F||y.set({raycaster:F=new We});const{params:q,...G}=D||{};if(A.equ(G,F,$)||U(F,{...G}),A.equ(q,F.params,$)||U(F,{params:{...F.params,...q}}),!y.camera||y.camera===m&&!A.equ(m,I,$)){m=I;const k=I instanceof tt,O=k?I:E?new Ve(0,0,0,0,.1,1e3):new Xe(75,0,.1,1e3);k||(O.position.z=5,I&&U(O,I),!y.camera&&!(I!=null&&I.rotation)&&O.lookAt(0,0,0)),y.set({camera:O})}if(!y.scene){let k;u instanceof _e?k=u:(k=new _e,u&&U(k,u)),y.set({scene:W(k)})}if(!y.xr){const k=(L,K)=>{const H=v.getState();H.frameloop!=="never"&&Me(L,!0,H,K)},O=()=>{const L=v.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?k:null),L.gl.xr.isPresenting||Se(L)},B={connect(){const L=v.getState().gl;L.xr.addEventListener("sessionstart",O),L.xr.addEventListener("sessionend",O)},disconnect(){const L=v.getState().gl;L.xr.removeEventListener("sessionstart",O),L.xr.removeEventListener("sessionend",O)}};T.xr&&B.connect(),y.set({xr:B})}if(T.shadowMap){const k=T.shadowMap.enabled,O=T.shadowMap.type;if(T.shadowMap.enabled=!!h,A.boo(h))T.shadowMap.type=ae;else if(A.str(h)){var N;const B={basic:nt,percentage:rt,soft:ae,variance:ot};T.shadowMap.type=(N=B[h])!=null?N:ae}else A.obj(h)&&Object.assign(T.shadowMap,h);(k!==T.shadowMap.enabled||O!==T.shadowMap.type)&&(T.shadowMap.needsUpdate=!0)}const z=Te();z&&("enabled"in z?z.enabled=!p:"legacyMode"in z&&(z.legacyMode=p)),U(T,{outputEncoding:a?3e3:3001,toneMapping:l?Ye:Ke}),y.legacy!==p&&y.set(()=>({legacy:p})),y.linear!==a&&y.set(()=>({linear:a})),y.flat!==l&&y.set(()=>({flat:l})),r&&!A.fun(r)&&!ze(r)&&!A.equ(r,T,$)&&U(T,r),f&&!y.events.handlers&&y.set({events:f(v)});const b=Dt(e,c);return A.equ(b,y.size,$)||y.setSize(b.width,b.height,b.updateStyle,b.top,b.left),M&&y.viewport.dpr!==Le(M)&&y.setDpr(M),y.frameloop!==S&&y.setFrameloop(S),y.onPointerMissed||y.set({onPointerMissed:j}),x&&!A.equ(x,y.performance,$)&&y.set(k=>({performance:{...k.performance,...x}})),_=w,i=!0,this},render(n){return i||this.configure(),oe.updateContainer(R.createElement(It,{store:v,children:n,onCreated:_,rootElement:e}),C,null,()=>{}),v},unmount(){qe(e)}}}function It({store:e,children:t,onCreated:o,rootElement:s}){return ee(()=>{const d=e.getState();d.set(v=>({internal:{...v.internal,active:!0}})),o&&o(d),e.getState().events.connected||d.events.connect==null||d.events.connect(s)},[]),R.createElement(Be.Provider,{value:e},t)}function qe(e,t){const o=Y.get(e),s=o==null?void 0:o.fiber;if(s){const d=o==null?void 0:o.store.getState();d&&(d.internal.active=!1),oe.updateContainer(null,s,null,()=>{d&&setTimeout(()=>{try{var v,C,_,i;d.events.disconnect==null||d.events.disconnect(),(v=d.gl)==null||(C=v.renderLists)==null||C.dispose==null||C.dispose(),(_=d.gl)==null||_.forceContextLoss==null||_.forceContextLoss(),(i=d.gl)!=null&&i.xr&&d.xr.disconnect(),Ct(d),Y.delete(e),t&&t(e)}catch{}},500)})}}oe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:R.version});const ve={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Ft(e){const{handlePointer:t}=Mt(e);return{priority:1,enabled:!0,compute(o,s,d){s.pointer.set(o.offsetX/s.size.width*2-1,-(o.offsetY/s.size.height)*2+1),s.raycaster.setFromCamera(s.pointer,s.camera)},connected:void 0,handlers:Object.keys(ve).reduce((o,s)=>({...o,[s]:t(s)}),{}),update:()=>{var o;const{events:s,internal:d}=e.getState();(o=d.lastEvent)!=null&&o.current&&s.handlers&&s.handlers.onPointerMove(d.lastEvent.current)},connect:o=>{var s;const{set:d,events:v}=e.getState();v.disconnect==null||v.disconnect(),d(C=>({events:{...C.events,connected:o}})),Object.entries((s=v.handlers)!=null?s:[]).forEach(([C,_])=>{const[i,m]=ve[C];o.addEventListener(i,_,{passive:m})})},disconnect:()=>{const{set:o,events:s}=e.getState();if(s.connected){var d;Object.entries((d=s.handlers)!=null?d:[]).forEach(([v,C])=>{if(s&&s.connected instanceof HTMLElement){const[_]=ve[v];s.connected.removeEventListener(_,C)}}),o(v=>({events:{...v.events,connected:void 0}}))}}}}const zt=R.forwardRef(function({children:t,fallback:o,resize:s,style:d,gl:v,events:C=Ft,eventSource:_,eventPrefix:i,shadows:m,linear:n,flat:r,legacy:c,orthographic:u,frameloop:f,dpr:w,performance:h,raycaster:a,camera:l,onPointerMissed:p,onCreated:E,...S},M){R.useMemo(()=>ht(st),[]);const x=mt(),[D,I]=pt({scroll:!0,debounce:{scroll:50,resize:0},...s}),j=R.useRef(null),y=R.useRef(null);R.useImperativeHandle(M,()=>j.current);const T=xe(p),[F,q]=R.useState(!1),[G,N]=R.useState(!1);if(F)throw F;if(G)throw G;const z=R.useRef(null);ee(()=>{const P=j.current;I.width>0&&I.height>0&&P&&(z.current||(z.current=Lt(P)),z.current.configure({gl:v,events:C,shadows:m,linear:n,flat:r,legacy:c,orthographic:u,frameloop:f,dpr:w,performance:h,raycaster:a,camera:l,size:I,onPointerMissed:(...b)=>T.current==null?void 0:T.current(...b),onCreated:b=>{b.events.connect==null||b.events.connect(_?_t(_)?_.current:_:y.current),i&&b.setEvents({compute:(k,O)=>{const B=k[i+"X"],L=k[i+"Y"];O.pointer.set(B/O.size.width*2-1,-(L/O.size.height)*2+1),O.raycaster.setFromCamera(O.pointer,O.camera)}}),E==null||E(b)}}),z.current.render(R.createElement(x,null,R.createElement(Ae,{set:N},R.createElement(R.Suspense,{fallback:R.createElement(yt,{set:q})},t)))))}),R.useEffect(()=>{const P=j.current;if(P)return()=>qe(P)},[]);const g=_?"none":"auto";return R.createElement("div",ke({ref:y,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:g,...d}},S),R.createElement("div",{ref:D,style:{width:"100%",height:"100%"}},R.createElement("canvas",{ref:j,style:{display:"block"}},o)))}),Yt=R.forwardRef(function(t,o){return R.createElement(vt,null,R.createElement(zt,ke({},t,{ref:o})))});export{Yt as C,Xt as a,Vt as g,Ne as u};
